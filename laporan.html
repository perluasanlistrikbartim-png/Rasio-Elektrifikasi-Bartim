<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Rasio Elektrifikasi â€“ Kabupaten Barito Timur</title>

<style>
/* ================= BASIC ================= */
body{
  margin:0;
  background:#020216;
  color:#e0f7ff;
  font-family:Segoe UI, sans-serif;
}

/* ================= HEADER ================= */
header{
  background:#000814;
  border-bottom:3px solid #f4b400;
  padding:14px 18px;
}
.header-inner{
  max-width:1200px;
  margin:auto;
  display:flex;
  align-items:center;
  gap:16px;
}
.header-logo img{
  height:48px;
}
.header-title h1{
  margin:0;
  font-size:1.6rem;
  font-weight:800;
}
.header-title span{
  font-size:13px;
  color:#ffe08a;
}

/* ================= CONTAINER ================= */
.container{
  max-width:1200px;
  margin:auto;
  padding:14px;
}

/* ================= FILTER LAPORAN ================= */
.laporan-filter{
  background:linear-gradient(180deg,#071a33,#050f22);
  border-radius:16px;
  padding:16px;
  display:grid;
  grid-template-columns:1fr 1fr auto;
  gap:12px;
  margin-bottom:16px;
}
.laporan-filter select,
.laporan-filter button{
  padding:10px;
  border-radius:10px;
  border:none;
  font-size:14px;
}
.laporan-filter select{
  background:#071a33;
  color:#fff;
}
.laporan-filter button{
  background:#f4b400;
  font-weight:800;
  cursor:pointer;
}

/* ================= INFO ================= */
.laporan-info{
  font-size:13px;
  color:#9ecbff;
  margin-bottom:10px;
}

/* ================= TABLE ================= */
.box-table{
  background:linear-gradient(180deg,#071a33,#050f22);
  border-radius:18px;
  padding:14px;
}
.table-title{
  font-weight:800;
  color:#ffe08a;
  margin-bottom:10px;
}
.table-scroll{
  max-height:65vh;
  overflow:auto;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  padding:8px 10px;
  border-bottom:1px solid rgba(255,255,255,.15);
}
th{
  background:#0b2442;
  color:#7dd3fc;
  position:sticky;
  top:0;
}

/* ================= FOOTER ================= */
.footer{
  margin-top:30px;
  border-top:3px solid #f4b400;
  background:#000814;
}
.footer-inner{
  max-width:1200px;
  margin:auto;
  padding:16px;
  text-align:center;
  font-size:12px;
  color:#9ecbff;
}

/* ================= RESPONSIVE ================= */
@media(max-width:768px){
  .laporan-filter{
    grid-template-columns:1fr;
  }
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div class="header-logo">
      <img src="bartim.png">
    </div>
    <div class="header-title">
      <h1>Laporan Rasio Elektrifikasi</h1>
      <span>Kabupaten Barito Timur</span>
    </div>
  </div>
</header>

<div class="container">

  <!-- FILTER -->
  <div class="laporan-filter">
    <select id="tahun">
      <option value="">Pilih Tahun</option>
    </select>

    <select id="triwulan">
      <option value="">Pilih Triwulan</option>
      <option value="I">Triwulan I</option>
      <option value="II">Triwulan II</option>
      <option value="III">Triwulan III</option>
      <option value="IV">Triwulan IV</option>
    </select>

    <button onclick="loadLaporan()">ðŸ“„ Tampilkan</button>
  </div>

  <div class="laporan-info" id="info"></div>

  <!-- TABEL -->
  <div class="box-table">
    <div class="table-title">ðŸ“Š Data Snapshot Rasio Elektrifikasi</div>
    <div class="table-scroll">
      <table id="tbl">
        <thead>
          <tr>
            <th>No</th>
            <th>Kecamatan</th>
            <th>Desa / Kelurahan</th>
            <th>RT PLN</th>
            <th>RT Non PLN</th>
            <th>RT Non Listrik</th>
            <th>Jumlah RT</th>
            <th>% PLN</th>
            <th>% Non PLN</th>
            <th>% Tidak Berlistrik</th>
            <th>Updated</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<footer class="footer">
  <div class="footer-inner">
    Sistem Informasi Rasio Elektrifikasi â€“ Kabupaten Barito Timur
  </div>
</footer>

<script>
/* ================= CONFIG ================= */
const API_URL =
"https://script.google.com/macros/s/AKfycbxa-soCZiiqGB86ND1s5tKaIBwHSz0OGmv9OgJoDXYLKS1DvgcGy6e1sInZI3JD0oSm/exec";

/* ================= INIT ================= */
const tahunSel = document.getElementById("tahun");
const triSel   = document.getElementById("triwulan");
const tbody    = document.querySelector("#tbl tbody");
const infoBox  = document.getElementById("info");

/* isi tahun mulai 2025 */
const now = new Date().getFullYear();
for(let y=2025;y<=now+1;y++){
  const o=document.createElement("option");
  o.value=y; o.textContent=y;
  tahunSel.appendChild(o);
}

/* ================= LOAD LAPORAN ================= */
function loadLaporan(){
  const tahun = tahunSel.value;
  const tri   = triSel.value;

  if(!tahun || !tri){
    alert("Pilih tahun dan triwulan");
    return;
  }

  tbody.innerHTML="";
  infoBox.innerText="Memuat data laporan...";

  fetch(`${API_URL}?action=getLaporan&tahun=${tahun}&triwulan=${tri}`)
  .then(r=>r.json())
  .then(res=>{
    if(res.status!=="ok" || !res.data.length){
      infoBox.innerText="âš ï¸ Snapshot belum tersedia untuk periode ini.";
      return;
    }

    infoBox.innerText =
      `Menampilkan Laporan Triwulan ${tri} Tahun ${tahun}
       (Dikunci: ${res.data[0].waktu_kunci || "-"})`;

    res.data.forEach((d,i)=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${i+1}</td>
        <td>${d.kecamatan}</td>
        <td>${d.nama_wilayah}</td>
        <td>${d.rt_pln}</td>
        <td>${d.rt_non_pln}</td>
        <td>${d.rt_non_listrik}</td>
        <td>${d.jumlah}</td>
        <td>${fmt(d.persen_pln)}</td>
        <td>${fmt(d.persen_non_pln)}</td>
        <td>${fmt(d.persen_tidak_berlistrik)}</td>
        <td>${d.updated_at||""}</td>`;
      tbody.appendChild(tr);
    });
  });
}

/* ================= UTIL ================= */
function fmt(v){
  if(v===null||v==="") return "0.00%";
  if(String(v).includes("%")) return v;
  return (Number(v)*100).toFixed(2)+"%";
}
</script>

</body>
</html>
