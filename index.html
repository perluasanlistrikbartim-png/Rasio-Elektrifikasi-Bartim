<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebGIS Rasio Elektrifikasi ‚Äì Kabupaten Barito Timur</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
/* =====================================================
   RESET AMAN (TIDAK MERUSAK LEAFLET)
===================================================== */
html,body{
  margin:0;
  padding:0;
  background:#020216;
  color:#e0f7ff;
  font-family:Segoe UI, sans-serif;
}

/* =====================================================
   HEADER (CENTER, STABIL)
===================================================== */
header{
  background:#000814;
  border-bottom:3px solid #f4b400;
  position:relative;
  overflow:hidden;
}

header::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(
    120deg,
    transparent 30%,
    rgba(255,255,255,.18),
    transparent 70%
  );
  transform:translateX(-120%);
  animation:kilat 6s infinite;
}

@keyframes kilat{
  0%,85%{transform:translateX(-120%)}
  100%{transform:translateX(120%)}
}

.header-inner{
  max-width:1200px;
  margin:auto;
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
}

.header-logo img{
  height:46px;
  width:auto;
  filter:drop-shadow(0 0 6px rgba(244,180,0,.6));
}

.header-title{
  text-align:center;
}

.header-title h1{
  margin:0;
  font-size:1.5rem;
  font-weight:800;
  color:#fff;
}

.header-title span{
  font-size:13px;
  color:#ffe08a;
}

/* =====================================================
   CONTAINER UTAMA (SEMUA TENGAH)
===================================================== */
.container{
  max-width:1200px;
  margin:auto;
  padding:14px;
}

/* =====================================================
   SNAPSHOT PANEL (TERKUNCI AMAN)
===================================================== */
.snapshot-wrapper{
  max-width:1200px;
  margin:16px auto 20px;
  padding:0 14px;
}

.snapshot-box{
  background:linear-gradient(180deg,#071a33,#050f22);
  border-radius:16px;
  padding:16px;
  box-shadow:0 0 26px rgba(0,180,255,.25);
  border:1px solid rgba(255,255,255,.08);
}

.snapshot-title{
  font-weight:800;
  color:#ffe08a;
  margin-bottom:4px;
}

.snapshot-desc{
  font-size:12px;
  color:#9ecbff;
  margin-bottom:14px;
}

.snapshot-form{
  display:grid;
  grid-template-columns:1fr 1fr auto auto;
  gap:12px;
}

.snapshot-form select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#071a33;
  color:#fff;
}

.snapshot-form button{
  padding:10px 16px;
  border:none;
  border-radius:10px;
  font-weight:800;
  cursor:pointer;
  white-space:nowrap;
}

.btn-lock{background:#f4b400;color:#000}
.btn-laporan{
  background:linear-gradient(135deg,#0ea5e9,#0284c7);
  color:#fff;
}

.snapshot-status{
  margin-top:14px;
}

.snapshot-status table{
  width:100%;
  font-size:12px;
  border-collapse:collapse;
}

.snapshot-status th,
.snapshot-status td{
  padding:8px;
  border-bottom:1px dashed rgba(255,255,255,.15);
}

.snapshot-status th{color:#9ecbff}

/* =====================================================
   FILTER KECAMATAN
===================================================== */
#filterKec{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#071a33;
  color:#fff;
  margin-bottom:12px;
}

/* =====================================================
   MAP (LEAFLET AMAN)
===================================================== */
#map{
  width:100%;
  height:65vh;
  border-radius:16px;
  box-shadow:0 0 20px #000;
}

/* JANGAN RUSAK LEAFLET */
.leaflet-container *{
  box-sizing:content-box;
}

/* =====================================================
   MARKER BARTIM + LABEL DESA
===================================================== */
.marker-bartim{
  display:flex;
  flex-direction:column;
  align-items:center;
}

.marker-bartim img{
  width:32px;
  height:32px;
  filter:drop-shadow(0 0 6px rgba(0,180,255,.6));
}

.marker-label{
  margin-bottom:6px;
  padding:4px 8px;
  background:rgba(5,15,34,.85);
  color:#e0f7ff;
  font-size:11px;
  font-weight:600;
  border-radius:10px;
  white-space:nowrap;
  box-shadow:0 4px 10px rgba(0,0,0,.6);
}

.marker-kilat{
  font-size:13px;
  color:#ffd700;
  text-shadow:0 0 8px rgba(255,215,0,.9);
}

/* =====================================================
   SUMMARY
===================================================== */
.summary-box{
  margin-top:14px;
  padding:16px;
  border-radius:16px;
  background:linear-gradient(135deg,#071a33,#050f22);
  text-align:center;
}

.summary-title{color:#9ecbff;font-size:14px}
.summary-value{font-size:26px;font-weight:900;color:#00e5ff}
.summary-sub{font-size:12px;color:#c7eaff}

/* =====================================================
   TABLE
===================================================== */
.box-table{
  margin-top:18px;
  background:linear-gradient(180deg,#071a33,#050f22);
  border-radius:18px;
  padding:14px;
}

.table-title{font-weight:700;color:#9ecbff;margin-bottom:10px}

.table-scroll{max-height:45vh;overflow:auto}

table{
  width:100%;
  font-size:13px;
  border-collapse:separate;
  border-spacing:0;
}

th,td{
  padding:8px 10px;
  border-bottom:1px solid rgba(0,180,255,.3);
}

th{
  position:sticky;
  top:0;
  background:#0b2442;
  color:#7dd3fc;
}

/* =====================================================
   PANEL DETAIL (VIEW & EDIT STABIL)
===================================================== */
/* =====================================================
   PANEL DETAIL (STYLE SISFO JEMBATAN ‚Äì FIX)
===================================================== */
/* =====================================================
   PANEL DETAIL ‚Äì STYLE SISFO JEMBATAN (FINAL)
===================================================== */
#panel{
  position:absolute;
  top:110px;
  right:20px;
  width:340px;
  background:linear-gradient(180deg,#071a33,#050f22);
  border-radius:16px;
  padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.85);
  display:none;
  z-index:999;
}

/* PANEL MUNCUL */
#panel.show{
  display:block;
}

/* ===== PANEL HEADER ===== */
.panel-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:8px;
}

.panel-title{
  font-weight:700;
  font-size:14px;
  color:#ffe08a;
  letter-spacing:.5px;
}

.panel-close{
  background:none;
  border:none;
  color:#fff;
  font-size:22px;
  cursor:pointer;
  line-height:1;
}

/* ===== FOTO / LOGO PANEL (SISFO JEMBATAN STYLE) ===== */
#panel img{
  width:100%;
  max-height:220px;
  object-fit:contain;
  display:block;
  border-radius:12px;
  border:2px solid #f4b400;
  margin-bottom:10px;
  background:#000;
}

/* ===== BODY INFO ===== */
.panel-body{
  background:rgba(0,0,0,.35);
  border-radius:12px;
  padding:12px;
}

/* MODE VIEW / EDIT */
.view-only{display:block}
.edit-only{display:none}

#panel.edit-mode .view-only{display:none}
#panel.edit-mode .edit-only{display:block}

/* FOOTER */
.panel-footer{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed rgba(255,255,255,.15);
  text-align:center;
  font-size:11px;
  color:#9ecbff;
}

/* MOBILE */
@media(max-width:768px){
  #panel{
    top:auto;
    bottom:0;
    left:0;
    right:0;
    width:100%;
    max-height:55vh;
    border-radius:18px 18px 0 0;
  }

  #panel img{
    max-height:180px;
  }
}



/* =====================================================
   RESPONSIVE
===================================================== */
@media(max-width:900px){
  .snapshot-form{grid-template-columns:1fr 1fr}
}

@media(max-width:520px){
  .snapshot-form{grid-template-columns:1fr}
}

@media(max-width:768px){
  .header-inner{flex-direction:column}
  #panel{
    top:auto;
    bottom:0;
    left:0;
    right:0;
    width:100%;
    max-height:55vh;
    border-radius:18px 18px 0 0;
  }
}
   /* =====================================================
   PANEL DETAIL ‚Äì BARIS DATA RAPI (SISFO JEMBATAN STYLE)
===================================================== */

/* container tiap baris info */
.panel-body .info-block{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
  padding:6px 4px;
  border-bottom:1px solid rgba(0,180,255,.18);
}

/* hapus garis di baris terakhir */
.panel-body .info-block:last-child{
  border-bottom:none;
}

/* label kiri */
.panel-body .info-block .label{
  font-size:11px;
  color:#7dd3fc;              /* biru cerah */
  flex:0 0 55%;
}

/* value kanan */
.panel-body .info-block .value{
  font-size:12px;
  font-weight:600;
  color:#e0f7ff;              /* putih kebiruan */
  text-align:right;
  flex:1;
}

/* angka penting (opsional lebih tegas) */
.panel-body .info-block .value strong{
  color:#00e5ff;
}

/* tombol edit lebih rapi */
.panel-body .btn-action{
  margin-top:10px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,#0ea5e9,#0284c7);
  color:#fff;
}
panel-footer-inner{
</style>


</head>

<body>

<header>
  <div class="header-inner">

    <!-- LOGO -->
    <div class="header-logo">
      <img src="bartim.png" alt="Kabupaten Barito Timur">
    </div>

    <!-- TITLE -->
    <div class="header-title">
      <h1>WebGIS Rasio Elektrifikasi</h1>
      <span>Kabupaten Barito Timur</span>
    </div>

  </div>
</header>

  <div class="snapshot-wrapper">
<div class="snapshot-box">

  <div class="snapshot-title">
    üîê Kunci Data Laporan Rasio Elektrifikasi
  </div>

  <div class="snapshot-desc">
    Digunakan untuk mengunci data resmi per triwulan sebagai dasar laporan.
  </div>

  <div class="snapshot-form">

    <select id="snapTriwulan">
      <option value="">‚Äî Pilih Triwulan ‚Äî</option>
      <option value="I">Triwulan I</option>
      <option value="II">Triwulan II</option>
      <option value="III">Triwulan III</option>
      <option value="IV">Triwulan IV</option>
    </select>

    <select id="snapTahun">
      <option value="">‚Äî Pilih Tahun ‚Äî</option>
      <option value="2025">2025</option>
      <option value="2026">2026</option>
      <option value="2027">2027</option>
      <option value="2028">2028</option>
    </select>

    <button onclick="kunciSnapshot()">üîê Kunci Laporan</button>
<button class="btn-laporan" onclick="goLaporan()">
  üìÑ Buka Halaman Laporan
</button>

  </div>

  <div class="snapshot-status">
    <strong>Riwayat Snapshot Terkunci</strong>
    <table>
      <thead>
        <tr>
          <th>Triwulan</th>
          <th>Tahun</th>
          <th>Status</th>
          <th>Waktu</th>
        </tr>
      </thead>
      <tbody id="snapshotTable">
        <tr>
          <td colspan="4" style="text-align:center;opacity:.6">
            Belum ada snapshot
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
</div>
<div class="container">
  <select id="filterKec">
    <option value="">‚Äî Pilih Kecamatan‚Äî</option>
    <option value="ALL">Semua Kecamatan</option>
  </select>

  <div id="map"></div>

  <div id="summary" class="summary-box" style="display:none">
    <div class="summary-title" id="summaryTitle"></div>
    <div class="summary-value" id="summaryValue"></div>
    <div class="summary-sub" id="summarySub"></div>
  </div>
</div>

<div class="container">

  <!-- TABEL DESA -->
  <div class="box-table">
    <div class="table-title">üìä Data Rasio Elektrifikasi Desa</div>
    <div class="table-scroll">
      <table id="tbl">
        <thead>
          <tr>
            <th>No</th>
            <th>Kecamatan</th>
            <th>Desa/Kelurahan</th>
            <th>Rumah Tangga Berlistrik PLN</th>
            <th>Rumah Tangga Berlistrik Non PLN</th>
            <th>Rumah Tangga Tidak Berlistrik</th>
            <th>Jumlah Rumah Tangga</th>
            <th>% Rumah Tangga Berlistrik PLN</th>
            <th>% Rumah Tangga Berlistrik Non PLN</th>
            <th>% Rumah Tangga Tidak Berlistrik</th>
            <th>Terakhir Update</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- REKAP KECAMATAN -->
  <div class="box-table" id="rekapBox" style="display:none">
    <div class="table-title">üìå Rekap Rasio Elektrifikasi per Kecamatan</div>
    <div class="table-scroll">
      <table id="rekapTbl">
        <thead>
          <tr>
            <th>Kecamatan</th>
            <th>Rumah Tangga Berlistrik PLN</th>
            <th>Rumah Tangga Berlistrik Non PLN</th>
            <th>Rumah Tangga Tidak Berlistrik</th>
            <th>Jumlah Rumah Tangga</th>
            <th>% Rumah Tangga Berlistrik PLN</th>
            <th>% Rumah Tangga Berlistrik Non PLN</th>
            <th>% Rumah Tangga Tidak Berlistrik</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<!-- PANEL DETAIL -->
<div id="panel">

  <div class="panel-header">
    <div class="panel-title">Detail Desa/Kelurahan</div>
    <button class="panel-close" onclick="closePanel()">‚úï</button>
  </div>

  <!-- ================= VIEW MODE ================= -->
  <div class="panel-body view-only">

    <div class="info-block"><div class="label">Kecamatan</div><div class="value" id="pKec"></div></div>
    <div class="info-block"><div class="label">Desa / Kelurahan</div><div class="value" id="pTitle"></div></div>
    <div class="info-block"><div class="label">Rumah Tangga Berlistrik PLN</div><div class="value" id="pPln"></div></div>
    <div class="info-block"><div class="label">Rumah Tangga Berlistrik Non PLN</div><div class="value" id="pNon"></div></div>
    <div class="info-block"><div class="label">Rumah Tangga Tidak Beristrik</div><div class="value" id="pNonListrik"></div></div>
    <div class="info-block"><div class="label">Jumlah Rumah Tangga</div><div class="value" id="pJml"></div></div>
    <div class="info-block"><div class="label">% Rumah Tangga Berlistrik PLN</div><div class="value" id="pPlnPersen"></div></div>
    <div class="info-block"><div class="label">% Rumah Tangga Berlistrik Non PLN</div><div class="value" id="pNonPlnPersen"></div></div>
    <div class="info-block"><div class="label">% Rumah Tangga Tidak Berlistrik</div><div class="value" id="pTidakPersen"></div></div>
    <div class="info-block"><div class="label">Terakhir Update</div><div class="value" id="pUpdated"></div></div>

    <button class="btn-action" onclick="editData()">‚úèÔ∏è Edit Data</button>

<div class="panel-footer">
  <div class="panel-footer-inner">
    <img src="bartim.png" alt="Bartim" class="panel-footer-logo">
    <div class="panel-footer-text">
      Sistem Informasi Rasio Elektrifikasi<br>
      Kabupaten Barito Timur
    </div>
  </div>
</div>


  </div>

  <!-- ================= EDIT MODE ================= -->
  <div class="panel-body edit-only">

    <!-- READONLY (TEKS SAJA) -->
    <div class="info-block"><div class="label">Kecamatan</div><div class="value" id="eKec"></div></div>
    <div class="info-block"><div class="label">Desa / Kelurahan</div><div class="value" id="eTitle"></div></div>
    <div class="info-block"><div class="label">Jumlah RT</div><div class="value" id="eJml"></div></div>

    <!-- EDITABLE (3 SAJA) -->
    <div class="info-block">
      <div class="label">Rumah Tangga Berlistrik PLN</div>
      <input id="ePln" type="number">
    </div>

    <div class="info-block">
      <div class="label">Rumah Tangga Berlistrik Non PLN</div>
      <input id="eNon" type="number">
    </div>

    <div class="info-block">
      <div class="label">Rumah Tangga Tidak Berlistrik</div>
      <input id="eTidak" type="number">
    </div>

    <div class="panel-footer">
  <div class="footer-actions">
    <button class="btn-action" onclick="saveEdit()">üíæ Simpan</button>
    <button class="btn-action" style="background:#444" onclick="cancelEdit()">‚ùå Batal</button>
  </div>
  <div style="margin-top:6px">
    Edit Data Desa/Kelurahan ‚Äì Akses Terbatas üîê
  </div>
</div>

  </div>

</div>




<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* ================== CONFIG ================== */
const API_URL =
"https://script.google.com/macros/s/AKfycbxa-soCZiiqGB86ND1s5tKaIBwHSz0OGmv9OgJoDXYLKS1DvgcGy6e1sInZI3JD0oSm/exec";

const snapshotData = []; // nanti diganti dari API

function kunciSnapshot(){
  const triwulan = snapTriwulan.value;
  const tahun    = snapTahun.value;

  if(!triwulan || !tahun){
    alert("Pilih Triwulan dan Tahun");
    return;
  }

  // CEK DUPLIKAT
  const ada = snapshotData.find(
    s => s.triwulan===triwulan && s.tahun===tahun
  );
  if(ada){
    alert("‚ö†Ô∏è Periode ini sudah dikunci");
    return;
  }

  const pin = prompt(
    `Masukkan PIN Snapshot\nTriwulan ${triwulan} ${tahun}`
  );
  if(!pin) return;

  // simulasi berhasil
  snapshotData.push({
    triwulan,
    tahun,
    waktu: new Date().toLocaleString("id-ID")
  });

  renderSnapshotTable();
  alert("‚úÖ Snapshot laporan berhasil dikunci");
}

function renderSnapshotTable(){
  const tb = document.getElementById("snapshotTable");
  tb.innerHTML = "";

  snapshotData.forEach(s=>{
    tb.innerHTML += `
      <tr>
        <td>Triwulan ${s.triwulan}</td>
        <td>${s.tahun}</td>
        <td style="color:#00e5ff;font-weight:700">TERKUNCI</td>
        <td>${s.waktu}</td>
      </tr>`;
  });
}
  function goLaporan(){
  window.location.href = "laporan.html";
}

/* ================= MAP ================= */
const map = L.map("map",{maxZoom:20}).setView([-2.1,115.1],8);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:20}).addTo(map);
const layer = L.layerGroup().addTo(map);

/* ================= DOM ================= */
const filterKec    = document.getElementById("filterKec");
const tbl          = document.getElementById("tbl");
const rekapTbl     = document.getElementById("rekapTbl");
const rekapBox     = document.getElementById("rekapBox");
const summary      = document.getElementById("summary");
const summaryTitle = document.getElementById("summaryTitle");
const summaryValue = document.getElementById("summaryValue");
const summarySub   = document.getElementById("summarySub");
const panel        = document.getElementById("panel");

/* PANEL VIEW */
const pKec  = id("pKec"),  pTitle = id("pTitle"), pPln = id("pPln"),
      pNon  = id("pNon"),  pNonL  = id("pNonListrik"),
      pJml  = id("pJml"),  pPlnP  = id("pPlnPersen"),
      pNonP = id("pNonPlnPersen"), pTidP = id("pTidakPersen"),
      pUpd  = id("pUpdated");

/* PANEL EDIT */
const eKec=id("eKec"), eTitle=id("eTitle"), eJml=id("eJml"),
      ePln=id("ePln"), eNon=id("eNon"), eTidak=id("eTidak");

/* ================= DATA ================= */
let data=[], selected=null;

/* ================= LOAD DATA ================= */
fetch(API_URL+"?action=getDesa")
.then(r=>r.json())
.then(j=>{
  data = j.data || [];
  [...new Set(data.map(d=>d.kecamatan))].forEach(k=>{
    const o=document.createElement("option");
    o.value=k; o.textContent=k;
    filterKec.appendChild(o);
  });
});

filterKec.onchange = render;

/* ================= RENDER ================= */
function render(){
  layer.clearLayers();
  tbl.querySelector("tbody").innerHTML="";
  rekapTbl.querySelector("tbody").innerHTML="";
 panel.classList.remove("show","edit-mode");

  if(!filterKec.value) return;

  const list = filterKec.value==="ALL"
    ? data
    : data.filter(d=>d.kecamatan===filterKec.value);

  let sumPln=0,sumNon=0,sumTidak=0,sumTotal=0;
  let rekap={}, bounds=[];

  list.forEach((d,i)=>{
    sumPln+=+d.rt_pln||0;
    sumNon+=+d.rt_non_pln||0;
    sumTidak+=+d.rt_non_listrik||0;
    sumTotal+=+d.jumlah||0;

    if(!rekap[d.kecamatan])
      rekap[d.kecamatan]={pln:0,non:0,tidak:0,total:0};

    rekap[d.kecamatan].pln+=+d.rt_pln||0;
    rekap[d.kecamatan].non+=+d.rt_non_pln||0;
    rekap[d.kecamatan].tidak+=+d.rt_non_listrik||0;
    rekap[d.kecamatan].total+=+d.jumlah||0;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${d.kecamatan}</td>
      <td>${d.nama_wilayah}</td>
      <td>${d.rt_pln}</td>
      <td>${d.rt_non_pln}</td>
      <td>${d.rt_non_listrik}</td>
      <td>${d.jumlah}</td>
      <td>${fmt(d.persen_pln)}</td>
      <td>${fmt(d.persen_non_pln)}</td>
      <td>${fmt(d.persen_tidak_berlistrik)}</td>
      <td>${d.updated_at||"2025"}</td>`;
    tr.onclick=()=>show(d);
    tbl.querySelector("tbody").appendChild(tr);

    if(d.latitude && d.longitude){
      const latlng=[
        Number(String(d.latitude).replace(",", ".")),
        Number(String(d.longitude).replace(",", "."))
      ];

      const icon=L.divIcon({
        className:"",
        html:`
          <div class="marker-bartim">
            <div class="marker-label">${d.nama_wilayah}</div>
            <div class="marker-kilat">‚ö°</div>
            <img src="bartim.png">
          </div>`,
        iconSize:[40,60],
        iconAnchor:[20,60]
      });

      L.marker(latlng,{icon})
        .addTo(layer)
        .on("click",()=>show(d));

      bounds.push(latlng);
    }
  });

  if(bounds.length)
    map.fitBounds(bounds,{padding:[40,40],maxZoom:13});

  summary.style.display="block";
  summaryValue.innerText =
    sumTotal ? (sumPln/sumTotal*100).toFixed(2)+"%" : "0%";
  summarySub.innerText =
    `RT PLN: ${sumPln} | Total RT: ${sumTotal}`;

  if(filterKec.value==="ALL"){
    summaryTitle.innerText="Rasio Elektrifikasi PLN Kabupaten Barito Timur";
    rekapBox.style.display="block";
    for(let k in rekap){
      const r=rekap[k];
      rekapTbl.querySelector("tbody").innerHTML+=`
        <tr>
          <td>${k}</td>
          <td>${r.pln}</td>
          <td>${r.non}</td>
          <td>${r.tidak}</td>
          <td>${r.total}</td>
          <td>${(r.pln/r.total*100).toFixed(2)}%</td>
          <td>${(r.non/r.total*100).toFixed(2)}%</td>
          <td>${(r.tidak/r.total*100).toFixed(2)}%</td>
        </tr>`;
    }
  }else{
    summaryTitle.innerText =
      "Rasio Elektrifikasi PLN Kecamatan "+filterKec.value;
    rekapBox.style.display="none";
  }
}

/* ================= PANEL VIEW ================= */
function show(d){
  selected=d;

  pKec.innerText=d.kecamatan;
  pTitle.innerText=d.nama_wilayah;
  pPln.innerText=d.rt_pln;
  pNon.innerText=d.rt_non_pln;
  pNonL.innerText=d.rt_non_listrik;
  pJml.innerText=d.jumlah;
  pPlnP.innerText=fmt(d.persen_pln);
  pNonP.innerText=fmt(d.persen_non_pln);
  pTidP.innerText=fmt(d.persen_tidak_berlistrik);
  pUpd.innerText=d.updated_at||"2025";

  eKec.innerText=d.kecamatan;
  eTitle.innerText=d.nama_wilayah;
  eJml.innerText=d.jumlah;

  panel.classList.add("show");
panel.classList.remove("edit-mode");

}

/* ================= EDIT BY PIN ================= */
function editData(){
  if(!selected) return;

  const pin=prompt("Masukkan PIN Desa/Kelurahan:\n"+selected.nama_wilayah);
  if(!pin) return;

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"checkPin",
      id_desa:selected.id_desa,
      pin:pin
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status!=="ok") return alert("‚ùå PIN salah");

    panel.dataset.pin = pin;
    panel.classList.add("edit-mode");

    ePln.value=selected.rt_pln;
    eNon.value=selected.rt_non_pln;
    eTidak.value=selected.rt_non_listrik;
  });
}

/* ================= SAVE ================= */
function saveEdit(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"updateDesa",
      id_desa:selected.id_desa,
      pin:panel.dataset.pin,
      rt_pln:ePln.value,
      rt_non_pln:eNon.value,
      rt_non_listrik:eTidak.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status!=="ok") return alert("‚ùå Gagal simpan");
    alert("‚úÖ Data tersimpan");
    render();
  });
}

function cancelEdit(){
  panel.classList.remove("edit-mode");
}

/* ================= UTIL ================= */
function id(x){return document.getElementById(x)}
function fmt(v){
  if(v===null||v==="") return "0.00%";
  if(String(v).includes("%")) return v;
  return (Number(v)*100).toFixed(2)+"%";
}

/* ================= PANEL ================= */
function closePanel(){panel.style.display="none"}
</script>




<footer class="footer">
  <div class="footer-inner">
    
    <div class="footer-left">
      <div class="footer-title">
        WebGIS Rasio Elektrifikasi Kabupaten Barito Timur
      </div>
      <div class="footer-sub">
       Kolaborasi Satu Data<br>
       DPUPRPERKIM Kabupaten Barito Timur<br>
       - Sekretariat Daerah Kabupaten Barito Timur
      </div>
    </div>

    <div class="footer-right">
      <div class="footer-credit">
        Presented in Web GIS App by
        <span class="footer-name">SEPTERIADY NGUBEL</span>
      </div>
      <div class="footer-year">
        ¬© <span id="tahunFooter"></span>
      </div>
    </div>

  </div>
</footer>

</body>
</html>
